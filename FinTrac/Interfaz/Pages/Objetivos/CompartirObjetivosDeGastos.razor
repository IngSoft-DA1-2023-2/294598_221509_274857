@page "/{objetivoId:int}/{MontoMaximo:double}/{Id:int}/objetivo/{Token}"
@using DTO;
@layout CompartirObjetivoDeGastosLayout
<PageTitle>FinTrac Objetivos</PageTitle>
<TituloRosado Titulo="Objetivo de gasto"></TituloRosado>
<EspacioActual></EspacioActual>


@if (objetivo != null)
{
	@if (objetivo.Token == Token)
	{
		<ul class="max-w-md divide-y divide-gray-200 dark:divide-gray-700">
			<div class=" px-4 pt-4 mb-5">
				<div class="flex flex-col pb-10">
					<h5 class="mb-1 text-xl font-medium text-gray-900 dark:text-white">
						El objetivo de @nombreAdmin
					</h5>
					<p class="text-sm text-gray-500 dark:text-gray-400">
						Categoria: @foreach (var categoria in objetivo.Categorias)
						{
							<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5
								rounded dark:bg-gray-700 dark:text-pink-400 border border-pink-400">
								@categoria.Nombre
							</span>
						}
					</p>

					<p class="text-sm text-gray-500 dark:text-gray-400">
						Objetivo: Gastar menos de $
						<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5
							rounded dark:bg-gray-700 dark:text-pink-400 border border-pink-400">
							@objetivo.MontoMaximo
						</span>
					</p>

					<p class="text-sm text-gray-500 dark:text-gray-400">
						Gastado actualmente: $
						<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5
							rounded dark:bg-gray-700 dark:text-pink-400 border border-pink-400">
							@montoAcumulado
						</span>
					</p>
				</div>
			</div>
		</ul>
	}
	else
	{
		<h1>Error al compartir objetivo de gasto</h1>
		<br />
		<h3>Lo sentimos, el token utilizado no está disponible.</h3>
	}
}

@code
{
	[Parameter] public int Id { get; set; }
	[Parameter] public string Token { get; set; }
	[Parameter] public double MontoMaximo { get; set; }
	[Parameter] public int objetivoId { get; set; }
	private ObjetivoDTO objetivo;
	private double montoAcumulado = 0;
	private ControladorObjetivos controlador;
	private List<ObjetivoDTO> objetivos = new List<ObjetivoDTO>();
	private string nombreAdmin;

	protected override void OnInitialized()
	{
		controlador = new ControladorObjetivos(EspacioLogic);
		objetivos = controlador.ObjetivosDeEspacio(Id);
		objetivo = objetivos.FirstOrDefault(o => o.Id == objetivoId);
		var objetivosDeGasto = controlador.ObjetivosDeGastos(Id, objetivoId);
		foreach (var objetivoGasto in objetivosDeGasto)
		{
			if (objetivoGasto.Objetivo.Id == objetivo.Id)
			{
				if (objetivoGasto.MontoAcumulado != null)
				{
					montoAcumulado = objetivoGasto.MontoAcumulado;
				}
			}
		}
		nombreAdmin = controlador.NombreAdmin(Id);
	}
}