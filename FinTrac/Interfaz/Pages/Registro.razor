@page "/registro"
@layout RegistroLayout
@using Controlador;
<PageTitle>FinTrac Registro de Usuario</PageTitle>

<div style="text-align: center; margin-bottom: 3rem;">
	<TituloFintec TituloVerde="FinTrac" TituloNegro="Registro" Subtitulo="Registre su usuario en la app de ahorro mas importante de America Latina" />
</div>

<div class="row">
	<div class="col-md-6">
		<label class="">Email</label>
		<input @bind="Correo" class="input-estilo" placeholder="ejemplo@email.com" />
	</div>
	<div class="col-md-6">
		<label class="">Contraseña</label>
		<input @bind="Contrasena" type="password" class="input-estilo" placeholder="Contraseña" />
	</div>
</div>

<div class="row">
	<div class="col-md-6">
		<label class="">Nombre</label>
		<input @bind="Nombre" class="input-estilo" placeholder="Nombre" />
	</div>
	<div class="col-md-6">
		<label class="">Apellido</label>
		<input @bind="Apellido" class="input-estilo" placeholder="Apellido" />
	</div>
</div>

<div class="row">
	<div class="col-md-12">
		<label class="">Dirección</label>
		<input @bind="Direccion" class="input-estilo" placeholder="Dirección" />
	</div>
</div>
<p style="color:red">@ErrorMensaje</p>
<div style="padding-top: 7px" class="mb-4">
	<BotonVerdeAgua NombreBoton="Registro" ClickIngreso="ClickRegistro" />
</div>

@code {
	public string ErrorMensaje { get; set; } = "";
	public string Correo { get; set; } = "";
	public string Contrasena { get; set; } = "";
	public string Nombre { get; set; } = "";
	public string Apellido { get; set; } = "";
	public string Direccion { get; set; } = "";
	private ControladorRegistro controlador;
	private int idEspacioPrincipal;

	protected override void OnInitialized()
	{
		controlador = new ControladorRegistro(UsuarioLogic, EspacioLogic);
	}

	public void ClickRegistro()
	{
		try
		{
			var usuario = new UsuarioDTO()
				{
					Nombre = Nombre,
					Apellido = Apellido,
					Correo = Correo,
					Contrasena = Contrasena,
					Direccion = Direccion
				};
		
		
		controlador.RegistrarUsuario(Correo, Nombre, Apellido, Contrasena, Direccion, idEspacioPrincipal);
		Persistencia.Id = idEspacioPrincipal;
		Persistencia.Correo = Correo;
		NavigationManager.NavigateTo($"/home/{idEspacioPrincipal}/{Correo}");
	}
	catch (DomainUsuarioException ex)
	{
		ErrorMensaje = ex.Message;
	}
	catch (BussinesLogicUsuarioException ex)
	{
		ErrorMensaje = ex.Message;
	}
	catch (DomainEspacioException ex)
	{
	ErrorMensaje = ex.Message;
}
}
}