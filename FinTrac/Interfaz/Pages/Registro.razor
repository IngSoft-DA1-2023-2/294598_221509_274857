@page "/registro"
@layout RegistroLayout
@using Controlador;
<PageTitle>FinTrac Registro de Usuario</PageTitle>

<div style="text-align: center; margin-bottom: 3rem;">
	<TituloFintec TituloVerde="FinTrac" TituloNegro="Registro" Subtitulo="Registre su usuario en la app de ahorro mas importante de America Latina" />
</div>

<div class="row">
	<div class="col-md-6">
		<label class="">Email</label>
		<input @bind="Email" class="input-estilo" placeholder="ejemplo@email.com" />
	</div>
	<div class="col-md-6">
		<label class="">Contraseña</label>
		<input @bind="Password" type="password" class="input-estilo" placeholder="Contraseña" />
	</div>
</div>

<div class="row">
	<div class="col-md-6">
		<label class="">Nombre</label>
		<input @bind="Nombre" class="input-estilo" placeholder="Nombre" />
	</div>
	<div class="col-md-6">
		<label class="">Apellido</label>
		<input @bind="Apellido" class="input-estilo" placeholder="Apellido" />
	</div>
</div>

<div class="row">
	<div class="col-md-12">
		<label class="">Dirección</label>
		<input @bind="Direccion" class="input-estilo" placeholder="Dirección" />
	</div>
</div>
<p style="color:red">@ErrorMensaje</p>
<div style="padding-top: 7px" class="mb-4">
	<BotonVerdeAgua NombreBoton="Registro" ClickIngreso="ClickRegistro" />
</div>

@code {
	public string ErrorMensaje { get; set; } = "";
	public string Email { get; set; } = "";
	public string Password { get; set; } = "";
	public string ConfirmPassword { get; set; } = "";
	public string Nombre { get; set; } = "";
	public string Apellido { get; set; } = "";
	public string Direccion { get; set; } = "";

	public void LimpiarInputs()
	{
		Email = "";
		Password = "";
		ConfirmPassword = "";
		Nombre = "";
		Apellido = "";
		Direccion = "";
	}

	public void ClickRegistro()
	{
		try
		{
			Usuario usuario = new Usuario()
				{
					Nombre = Nombre,
					Apellido = Apellido,
					Direccion = Direccion,
					Correo = Email,
					Contrasena = Password,
					IdEspacioPrincipal = EspacioLogic.EspacioMayorId() + 1,
				};
			Espacio espacioPrincipal = new Espacio()
				{
					Nombre = $"Principal {usuario.Nombre}",
					Admin = usuario,
				};
			LimpiarInputs();
			try
			{
				UsuarioLogic.AddUsuario(usuario);
				EspacioLogic.AddEspacio(espacioPrincipal);
				Persistencia.Id = espacioPrincipal.Id;
				Persistencia.Correo = usuario.Correo;
				NavigationManager.NavigateTo($"/home/{espacioPrincipal.Id}/{usuario.Correo}");
				ErrorMensaje = "";
			}
			catch (Exception exception)
			{
				LimpiarInputs();
				ErrorMensaje = exception.Message;
			}
		}
		catch (DomainUsuarioException exception)
		{
			LimpiarInputs();
			ErrorMensaje = exception.Message;
		}
	}
}