@page "/home/{Id:int}/{Correo}/Espacios"
@inject NavigationManager NavigationManager

@using BussinesLogic
@using Domain
@inject UsuarioLogic UsuarioLogic;
@inject EspacioLogic EspacioLogic;
@inject Persistencia Persistencia;

<PageTitle>FinTec Registro de Usuario</PageTitle>
<EspacioActual></EspacioActual>

@foreach (var espacio in espacios)
{
	<div class="card">
		<div class="card-body">
			<h5 class="card-title"><strong>Nombre</strong>@espacio.Nombre</h5>
			@if (espacio.Admin.Correo == Persistencia.Correo)
			{
				<p>Soy administrador</p>
			}
			<p class="card-text"><Strong>Admin:</Strong>@($"{espacio.Admin.Nombre} {espacio.Admin.Apellido}")</p>
			<button class="btn btn-primary" @onclick="() => ClickCambiarDeEspacio(espacio)">Cambiar de Espacio</button>
			@if (espacio.Admin.Correo == Persistencia.Correo)
			{
				<button class="btn btn-primary" @onclick="MostrarInput">Cambiar Nombre</button>
				@if (mostrarInput)
				{
					<input type="text" @bind="nuevoNombre" />

					<button class="btn btn-primary" @onclick="() => CambiarNombre(espacio)">Guardar</button>
					<p style="color:red">@ErrorMsg</p>
				}
			}
		</div>
	</div>
}

<a class="btn btn-success btn-sm" href="/home/@Persistencia.Id/@Persistencia.Correo/CrearEspacios">Crear Espacio</a>



@code {
	[Parameter] public int Id { get; set; }
	[Parameter] public string Correo { get; set; }
	public List<Espacio>? espacios { get; set; }
	public Usuario? usuario { get; set; }
	public string? ErrorMsg { get; set; }
	protected override void OnInitialized()
	{

		espacios = EspacioLogic.EspaciosByCorreo(Correo);
		usuario = UsuarioLogic.UsuarioByCorreo(Correo);
	}

	public void ClickCambiarDeEspacio(Espacio espacio)
	{
		Persistencia.Id = espacio.Id;
		NavigationManager.NavigateTo($"/home/{Persistencia.Id}/{Persistencia.Correo}");
	}

	private bool mostrarInput = false;
	private string nuevoNombre = string.Empty;

	private void MostrarInput()
	{
		mostrarInput = !mostrarInput;
	}

	private void CambiarNombre(Espacio espacio)
	{
		try
		{
			espacio.Nombre = nuevoNombre;
			NavigationManager.NavigateTo($"/home/{Persistencia.Id}/{Persistencia.Correo}");
			ErrorMsg = "";
			mostrarInput = false;
		}
		catch (DomainEspacioException e)
		{
			ErrorMsg = e.Message;
		}
	}
}
